<!DOCTYPE html>
<html>
   <head><title>test pascal js</title></head>
   <body>

      <a href="tests.html">Test suite</a>
      <br />
      <strong id="ready" style="visibility: hidden;">ready</strong>
      <br />

      <div id="container"></div>
      <div id="actions">
         <button id="testInputs" data-demo="inputDemo">test inputs</button>
         <button id="testElem" data-demo="customElements">test custom elements</button>
         <button id="testIterator" data-demo="iteratorsDemo">test iterators</button>
      </div>

      <!--<script src="__dist/pjs-0.0.1.js"></script>-->
      <script src="_loader.js"></script>

      <script>
         document.addEventListener('librairyLoaded', function(){
            document.getElementById('ready').style = '';
         });

         var components = {
            customElements: {
               script: 'components/customElements/custom.elements.js',
               callback: runCustomElems
            },
            inputDemo:{
               script: 'components/inputsDemo/inputs.demo.js',
               callback: runInputComp
            },
            iteratorsDemo:{
               script: 'components/iteratorDemo/iterator.demo.js',
               callback: runIteratorComp
            }
         }

         document.querySelectorAll('[data-demo]').forEach(function(button){
            button.addEventListener('click', function(){
               var demo = button.dataset.demo;
               var c = components[demo];
               addScript(demo, c.script, c.callback);
            });
         });

         function runIteratorComp(){
            var div = document.getElementById('container');
            var model = {
               list: [{
                  title: "a",
                  list: [{ title: "1" }, { title: "2" }]
               }, {
                  title: "b",
                  list: [{ title: "3" }, { title: "4", list: [{ title: "A" }] }]
               }, {
                  title: "c",
                  list: []
               }],
               condition: true
            };
            iteratorDemo.load(div, model);
         }

         function runCustomElems(){
            var div = document.getElementById('container');
            var model = {
               text: 'text'
            };
            customElem.load(div, model);
         }

         function runInputComp(){
            var div = document.getElementById('container');

            var model = {
               deep:{
                  value: "deep value"
               },
               textValue: "text",
               emailValue: "batman@adamwest.com",
               numberValue: 666,
               dateValue: new Date(),
               radioA: false,
               radioB: true,
               checkboxValue: false,
               textAreaValue: "text area",
               selection: 2,
               range:{
                  min: 10,
                  max: 30,
                  value: 15
               },
               color: '#f50344'
            }
            inputDemo.load(div, model).then(function (){
               console.log('component loaded')
            });
         }

         function addScript(id, path, then){
            var id = "componentScript" + id;
            if(!document.getElementById(id)){
               var tag = document.createElement('script');
               tag.setAttribute('id', id);
               tag.setAttribute('src', path);
               tag.onload = then;
               document.body.appendChild(tag);
            } else {
               then();
            }
         }
      </script>
   </body>
</html>
